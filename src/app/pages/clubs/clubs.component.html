<div class="row">
  <div class="col-md-12 mb-4">
    <h2>Clubes - {{ campName }}</h2>
    <div class="d-flex gap-2 w-100 justify-content-between">
      <a routerLink="/camps" class="text-decoration-none">
        <i class="bi bi-arrow-left"></i> Volver a Campamentos
      </a>
      <button
        class="btn btn-success"
        [routerLink]="['/camps', campId, 'clubs', 'new']"
      >
        Nuevo Club
      </button>
    </div>
  </div>
  <div class="col-md-12">
    <div class="mb-3">
      <div class="input-group">
        <span class="input-group-text">
          <i class="bi bi-search"></i>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="Buscar club por nombre..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
        >
      </div>
    </div>

    <div *ngIf="isLoading" class="text-center my-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
      {{ errorMessage }}
    </div>

    <table *ngIf="!isLoading && filteredClubs.length > 0" class="table table-striped">
      <thead>
        <tr>
          <th>Escudo</th>
          <th>Nombre</th>
          <th>Ciudad</th>
          <th>Miembros Bautizados</th>
          <th>Miembros No Bautizados</th>
          <th>Total Miembros</th>
          <th>Inscripción</th>
          <th>Pagado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let club of filteredClubs">
          <td class="text-center">
            <div *ngIf="club.shieldUrl" class="club-shield">
              <img 
                [src]="club.shieldUrl" 
                alt="Shield" 
                class="img-thumbnail" 
                style="max-height: 40px;"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
              <div style="display: none;" class="club-no-shield">
                <i class="bi bi-shield" style="font-size: 1.5rem;"></i>
              </div>
            </div>
            <div *ngIf="!club.shieldUrl" class="club-no-shield">
              <i class="bi bi-shield" style="font-size: 1.5rem;"></i>
            </div>
          </td>
          <td>{{ club.name }}</td>
          <td>{{ club.city }}</td>
          <td>{{ club.participantsCount }}</td>
          <td>{{ club.guestsCount }}</td>
          <td>
            {{ club.participantsCount + club.guestsCount }}
          </td>
          <td>{{ club.registrationFee | currency }}</td>
          <td>
            <i
              class="bi"
              [ngClass]="{
                'bi-check-circle-fill text-success': club.isPaid,
                'bi-x-circle-fill text-danger': !club.isPaid
              }"
            ></i>
          </td>
          <td>
            <div class="btn-group" role="group">
              <button
                type="button"
                class="btn btn-sm btn-primary"
                [routerLink]="['/camps', campId, 'clubs', club.id]"
                title="Ver detalles y resultados del club"
              >
                <i class="bi bi-eye"></i> Ver
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                [routerLink]="['/camps', campId, 'clubs', club.id, 'edit']"
              >
                <i class="bi bi-pencil"></i>
              </button>
              <button
                type="button"
                class="btn btn-sm btn-outline-danger"
                (click)="onDeleteClub(club.id)"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="!isLoading && filteredClubs.length === 0" class="alert alert-info">
      No se encontraron clubes que coincidan con la búsqueda.
    </div>
  </div>
</div>

<!-- Modal de confirmación para eliminación de club -->
<div class="modal fade" id="deleteClubModal" tabindex="-1" aria-labelledby="deleteClubModalLabel" aria-hidden="true" *ngIf="clubToDelete">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteClubModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Confirmar Eliminación de Club
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" (click)="cancelDelete()"></button>
      </div>
      <div class="modal-body">
        <div class="alert alert-warning mb-3">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>¡ATENCIÓN!</strong> Esta acción es <strong>irreversible</strong> y eliminará permanentemente el club y todos los datos asociados.
        </div>
        
        <p class="mb-3">
          Está a punto de eliminar el club <strong>"{{ clubToDelete.name }}"</strong>.
        </p>
        
        <p class="mb-3 text-danger">
          Se eliminarán todos los datos relacionados incluyendo:
        </p>
        <ul class="text-danger mb-3">
          <li>Información del club</li>
          <li>Calificaciones y resultados en eventos</li>
          <li>Historial de participación</li>
          <li>Archivos y documentos asociados</li>
        </ul>
        
        <div class="mb-3">
          <label for="confirmClubName" class="form-label">
            Para confirmar, escriba el nombre exacto del club: <strong>{{ clubToDelete.name }}</strong>
          </label>
          <input 
            type="text" 
            class="form-control" 
            id="confirmClubName"
            [(ngModel)]="confirmationText"
            placeholder="Escriba el nombre del club aquí"
            (input)="onConfirmationTextChange()"
          >
          <div class="form-text text-muted">
            El botón de confirmar se habilitará cuando escriba el nombre exacto.
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" (click)="cancelDelete()">
          Cancelar
        </button>
        <button 
          type="button" 
          class="btn btn-danger" 
          [disabled]="!canConfirmDelete || isDeletingClub"
          (click)="confirmDelete()"
        >
          <span *ngIf="isDeletingClub" class="spinner-border spinner-border-sm me-2"></span>
          <i *ngIf="!isDeletingClub" class="bi bi-trash me-2"></i>
          {{ isDeletingClub ? 'Eliminando...' : 'Eliminar Club' }}
        </button>
      </div>
    </div>
  </div>
</div>
