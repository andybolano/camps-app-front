<div class="container mt-4">
  <div class="row">
    <div class="col-12 mb-4">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2>Ranking General del Campamento</h2>
          <h5 *ngIf="camp" class="text-muted">{{ camp.name }}</h5>
        </div>
        <div class="d-flex gap-2 align-items-center">
          <a routerLink="/camps" class="text-decoration-none">
            <i class="bi bi-arrow-left"></i> Volver a Campamentos
          </a>
          <button
            *ngIf="!isLoading && rankingData.length > 0"
            class="btn btn-success btn-sm"
            (click)="exportToExcel()"
            title="Exportar ranking a Excel"
          >
            <i class="bi bi-file-earmark-excel"></i> Exportar Excel
          </button>
        </div>
      </div>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="col-12 text-center my-5">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="errorMessage" class="col-12">
      <div class="alert alert-danger">
        {{ errorMessage }}
      </div>
    </div>

    <!-- Sin resultados -->
    <div *ngIf="!isLoading && rankingData.length === 0" class="col-12">
      <div class="alert alert-info">
        No hay resultados registrados para este campamento. Califica los eventos
        para generar el ranking.
      </div>
    </div>

    <!-- Ranking General -->
    <div *ngIf="!isLoading && rankingData.length > 0" class="col-12">
      <h4 class="mb-3">Ranking General</h4>

      <!-- Tabla completa de resultados -->
      <div class="table-responsive" style="max-height: 70vh; overflow: auto">
        <table
          class="table table-striped table-hover"
          style="position: relative"
        >
          <thead class="table-light sticky-top">
            <tr>
              <th
                style="
                  width: 70px;
                  position: sticky;
                  left: 0;
                  z-index: 10;
                  background-color: var(--bs-light);
                "
                class="text-center"
              >
                Pos.
              </th>
              <th
                style="
                  min-width: 150px;
                  position: sticky;
                  left: 63px;
                  z-index: 10;
                  background-color: var(--bs-light);
                  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
                "
              >
                Club
              </th>
              <th
                *ngFor="let event of allEvents"
                style="min-width: 90px; font-size: 10px"
                [title]="event.description"
              >
                {{ event.name }}
              </th>
              <th
                class="text-center fw-bold"
                style="
                  width: 100px;
                  position: sticky;
                  right: 0;
                  z-index: 10;
                  background-color: var(--bs-light);
                  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
                "
              >
                Total
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of rankingData"
              [ngClass]="{
                'table-success': item.rank === 1,
                'table-warm': item.rank === 2,
                'table-info': item.rank === 3
              }"
            >
              <td
                class="text-center"
                style="
                  position: sticky;
                  left: 0;
                  z-index: 5;
                  background-color: white;
                "
              >
                <span
                  class="badge rounded-pill"
                  [ngClass]="getRankBadgeClass(item.rank)"
                >
                  {{ item.rank }}
                </span>
              </td>
              <td
                style="
                  position: sticky;
                  left: 63px;
                  z-index: 5;
                  background-color: white;
                  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
                "
              >
                <div>
                  <strong>{{ item.club.name }}</strong>
                  <div class="text-muted small">{{ item.club.city }}</div>
                </div>
              </td>
              <td *ngFor="let event of allEvents" class="text-center">
                {{ getEventScore(item, event.id) | number : "1.1-1" }}
              </td>
              <td
                class="text-center fw-bold"
                style="
                  position: sticky;
                  right: 0;
                  z-index: 5;
                  background-color: white;
                  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
                "
              >
                {{ item.totalScore | number : "1.1-1" }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
